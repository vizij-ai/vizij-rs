#!/usr/bin/env bash
set -euo pipefail

# Detect if running in WSL and find cargo
if [[ -d "/mnt/c/Users" ]]; then
    # Running in WSL - add Windows cargo to PATH
    WINDOWS_USER=$(whoami)
    export PATH="/mnt/c/Users/$WINDOWS_USER/.cargo/bin:$PATH"
    CARGO="cargo.exe"
elif command -v cargo.exe &> /dev/null; then
    # Windows Git Bash with .exe extension
    CARGO="cargo.exe"
elif command -v cargo &> /dev/null; then
    # Linux or macOS
    CARGO="cargo"
else
    echo "Error: cargo not found in PATH"
    exit 1
fi

echo "[pre-commit] cargo fmt --all"
$CARGO fmt --all

echo "[pre-commit] cargo clippy --all-targets -- -D warnings"
$CARGO clippy --all-targets -- -D warnings

echo "[pre-commit] OK"